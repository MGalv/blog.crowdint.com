<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Crowd Interactive Tech Blog :: Blog</title>
  <link rel="stylesheet" href="/stylesheets/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/stylesheets/print.css" type="text/css" media="print" />
  <link rel="stylesheet" href="/stylesheets/styles.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/stylesheets/skribit.css" type="text/css" media="screen" />
  <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" media="screen" />
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for blog.crowdint.com" href="http://feeds.feedburner.com/CrowdInteractiveTechBlog" />
  <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
  
</head>
<body>
  <div class="container">
    <div id="empty-header">
      <a href="/"><img src="/images/logo_03.png" id="logoHead" width="227" height="74" alt="LogoHead" /></a>
    </div>
    <div class="span-24 append-bottom testGlow">
      <div class="round-top span-24">
        &nbsp;
      </div>
      <div id="white-body" class="span-24">
        <div class="left-side span-17">
          
<div class="post prepend-1">
  <h1><a href="/2011/01/10/building-a-basic-dsl-to-create-callbacks-in-ruby.html">Building a basic DSL to create callbacks in Ruby</a></h1>
  <p class="author">
    <span class="date"><b>Jan 10</b><br />2011</span>
  </p>
  <div class="body prepend-1 append-1">
    <div class="gravatar span-3"><img src="http://www.gravatar.com/avatar/a302e7dd208f335dc67761a6db911561" class="avatar" alt="Avatar" /></div>
    <h2>Introduction</h2>

<p>Do you know what a <strong>Domain Specific Language(DSL)</strong> is and how to
implement one in Ruby?. This article aims to provide a slight introduction
to this topic. It is divided in 3 sections, first we'll define what a DSL is,
second we'll see some examples of DSL implementations, and third we'll build
a DSL.</p>

<h2>What is a DSL?</h2>

<p><a href="http://en.wikipedia.org/wiki/Domain-specific_language">According wikipedia</a> a
DSL is defined as:</p>

<blockquote><p>In software development and domain engineering, a domain-specific
language (DSL) is a programming language or specification language dedicated
to a particular problem domain, a particular problem representation
technique, and/or a particular solution technique.</p></blockquote>

<p>To clarify, we'll see some examples. As you read through them take into account
the following points:</p>

<ul>
<li><a href="http://rubylearning.com/satishtalim/ruby_blocks.html">Ruby blocks</a>
are used everywhere. They are the bare minimum construction element.</li>
<li>Though the used structures are not part of the Ruby core, all of
them use valid Ruby constructs.</li>
<li>The main purpose of creating new code structure is to provide a more
<em>human readable code</em>.</li>
</ul>


<p>This implies that the following DSL examples(codes) are build with
sentences like:</p>

<div class="highlight"><pre><code class="ruby">  <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">);</span> <span class="k">end</span>

  <span class="k">def</span> <span class="nf">Given</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">);</span> <span class="k">end</span>

  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">);</span> <span class="k">end</span>
</code></pre>
</div>


<p>Be aware, its respective gems may not define each DSL as I did, but it helps
to show different possible ways to do it.</p>

<p>Let's start with the examples.</p>

<h2>DSL implementations</h2>

<p>If you are doing Ruby then you probably have already used DSL's. Gems like
RSpec, Cucumber and Sinatra are good examples of DSL implementations. Let's
see their syntax and put special attention to the structures they use.</p>

<p>First, let's see three snippets from these languages.</p>

<h3>Rspec snippet</h3>

<p>In RSpec when you want to test if some object responds to a method call
you usually write something like:</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">describe</span> <span class="no">MyObject</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;should respond to a method call&#39;</span> <span class="k">do</span>
      <span class="n">subject</span><span class="o">.</span><span class="n">should</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:method_call</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
</div>


<h3>Cucumber snippet</h3>

<p>In Cucumber when you write step definitions you do things like:</p>

<div class="highlight"><pre><code class="ruby">  <span class="no">Given</span><span class="sr"> /^I click link &quot;([^&quot;&quot;]*)&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span>
    <span class="n">find</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>
</code></pre>
</div>


<h3>Sinatra snippet</h3>

<p>In Sinatra when you whant to write a route/controller you do something
like:</p>

<div class="highlight"><pre><code class="ruby">  <span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
    <span class="s2">&quot;Hi there&quot;</span>
  <span class="k">end</span>
</code></pre>
</div>


<p>Now let's write our own DSL.</p>

<h2>Writing a DSL</h2>

<p>The following technique intention is similar to that from
<a href="http://guides.rubyonrails.org/action_controller_overview.html#filters">Rails Controller Filters</a>.</p>

<p>Let's build a DSL called <strong>Wrappable</strong>. <strong>Wrappable</strong> will be a simple custom DSL that
<em>wrap</em>'s' a method  with <em>callbacks</em> using the Ruby language.</p>

<p>Let me clarify what I mean by <em>wrap</em> using the following snippet:</p>

<div class="highlight"><pre><code class="ruby">  <span class="k">def</span> <span class="nf">before</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">def</span> <span class="nf">original</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">def</span> <span class="nf">after</span><span class="p">;</span> <span class="k">end</span>
</code></pre>
</div>


<p><strong>Wrappable</strong> will <em>wrap</em> the <em>original</em> method. Whenever <em>original</em> is
invoked, the <em>before</em> method will be  automatically invoked first, second it
will invoke the <em>original</em> method and finally it will invoke the <em>after</em>
method.</p>

<p>The way the <em>before</em> and <em>after</em> methods behave is known as a
<a href="http://en.wikipedia.org/wiki/Callback_%28computer_programming%29">Callback</a>.</p>

<p>This behavior can also be achieved with something like:</p>

<div class="highlight"><pre><code class="ruby">  <span class="k">def</span> <span class="nf">before</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">def</span> <span class="nf">original</span>
    <span class="n">before</span>
    <span class="c1"># original sentences</span>
    <span class="n">after</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">after</span><span class="p">;</span> <span class="k">end</span>
</code></pre>
</div>


<p>But, I want to do this dynamically, using a <em>wrap</em> method that will be
able to setup the calls to the methods <em>before</em> and <em>after</em> programatically.</p>

<h3>Usage example</h3>

<p>We will end up the example with the following <strong>CallbackTest</strong> class:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">CallbackTest</span>

      <span class="c1"># This module contains the whole functionality</span>
      <span class="kp">include</span> <span class="no">Wrappable</span>

      <span class="k">def</span> <span class="nf">original</span>
        <span class="nb">puts</span> <span class="s2">&quot;Original method&quot;</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">before</span>
        <span class="nb">puts</span> <span class="s2">&quot;Before method&quot;</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">after</span>
        <span class="nb">puts</span> <span class="s2">&quot;After method&quot;</span>
      <span class="k">end</span>

      <span class="n">wrap</span> <span class="ss">:original</span> <span class="k">do</span>
        <span class="n">before_run</span> <span class="ss">:before</span>
        <span class="n">after_run</span> <span class="ss">:after</span>
      <span class="k">end</span>

    <span class="k">end</span>

    <span class="no">CallbackTest</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">original</span>
</code></pre>
</div>


<p>The script output should be as follows:</p>

<div class="highlight"><pre><code class="bash">    ...<span class="nv">$ </span>ruby my_test.rb
    Before method
    Original method     
    After method
</code></pre>
</div>


<h3>Writing the callback step by step</h3>

<p>In order to build the whole example let's start by listing what we require
to do and then we will code the example from scratch.</p>

<h4>The requirements</h4>

<p>Consider the script fragment where <em>wrap</em> is invoked:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">wrap</span> <span class="ss">:original</span> <span class="k">do</span>
      <span class="n">before_run</span> <span class="ss">:before</span>
      <span class="n">after_run</span> <span class="ss">:after</span>
    <span class="k">end</span>
</code></pre>
</div>


<p>This means:</p>

<ul>
<li><strong>Step 1</strong>, we need a class method called <em>wrap</em>. The <em>wrap</em> method has two
parameters: The first is the *symbol representing the name of the method that
will be wrapped and the second is a block.</li>
<li><strong>Step 2</strong>, the block parameter contains two method calls that configure
what methods should be invoked: <em>before_run</em> and <em>after_run</em>. Each method
receives one parameter as symbol that represents the name of the method
that will be invoked respectively.</li>
<li><strong>Step 3</strong>, create the <em>wrap</em> behavior. This step involves creating a new
method that will eventually call the <em>original</em>, <em>before</em> and <em>after</em>
methods and implies that we need to keep a reference to the <em>original</em>
method so we do not overwrite it.</li>
</ul>


<h4>Step 1</h4>

<p>What we are going to do here is:
* Create a <strong>Wrappable</strong> module with an empty <em>wrap</em> method and its two
  parameters.
* Add the <strong>Wrappable</strong> module methods to the <strong>CallbackTest</strong> metaclass
  (adding static methods).
* Invoking the <strong>Wrappable</strong>'s <em>wrap</em> method inside <em>CallbackTest</em> class.</p>

<p>Now, save the following snippet as <em>callback_test.rb</em>:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">module</span> <span class="nn">Wrappable</span>
      <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">original_method</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">CallbackTest</span>

      <span class="kp">extend</span> <span class="no">Wrappable</span>

      <span class="k">def</span> <span class="nf">original</span>
        <span class="nb">puts</span> <span class="s2">&quot;Original method&quot;</span>
      <span class="k">end</span>

      <span class="n">wrap</span> <span class="ss">:original</span> <span class="k">do</span>
      <span class="k">end</span>

    <span class="k">end</span>

    <span class="no">CallbackTest</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">original</span>
</code></pre>
</div>


<p>Now execute it:</p>

<div class="highlight"><pre><code class="bash">    ...<span class="nv">$ </span>ruby callback_test.rb
    Original method
</code></pre>
</div>


<h4>Step 2</h4>

<p>What we are going to do here is:</p>

<ul>
<li>Invoke the <em>before_run</em> and <em>after_run</em> inside the <em>wrap</em>'s parameter block.</li>
<li>Create a <strong>WrapperOptions</strong> class.

<ul>
<li>This class will namespace the <em>before_run</em> and <em>after_run</em> methods.</li>
<li>I want the <em>wrap</em>'s parameter block to be evaluated inside this
<strong>WrapperOptions</strong> class.</li>
<li>By using this class we can handle all options parsing in just one place.</li>
</ul>
</li>
</ul>


<p>Update <em>callback_test.rb</em> with the following:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">module</span> <span class="nn">Wrappable</span>
      <span class="k">class</span> <span class="nc">WrapperOptions</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
          <span class="nb">instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="kp">private</span>
        <span class="k">def</span> <span class="nf">before_run</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
          <span class="vi">@before</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">after_run</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
          <span class="vi">@after</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">original_method</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="n">wrapper_options</span> <span class="o">=</span> <span class="no">WrapperOptions</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">CallbackTest</span>

      <span class="kp">extend</span> <span class="no">Wrappable</span>

      <span class="k">def</span> <span class="nf">original</span>
        <span class="nb">puts</span> <span class="s2">&quot;Original method&quot;</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">before</span>
        <span class="nb">puts</span> <span class="s2">&quot;Before method&quot;</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">after</span>
        <span class="nb">puts</span> <span class="s2">&quot;After method&quot;</span>
      <span class="k">end</span>

      <span class="n">wrap</span> <span class="ss">:original</span> <span class="k">do</span>
        <span class="n">before_run</span> <span class="ss">:before</span>
        <span class="n">after_run</span> <span class="ss">:after</span>
      <span class="k">end</span>

    <span class="k">end</span>

    <span class="no">CallbackTest</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">original</span>
</code></pre>
</div>


<p>And verify that your script still works:</p>

<div class="highlight"><pre><code class="bash">    ...<span class="nv">$ </span>ruby callback_test.rb
    Original method
</code></pre>
</div>


<h4>Step 3</h4>

<p>Our <strong>CallbackTest</strong> remains unchanged. Let's improve and complete the
<strong>Wrappable</strong> module. What we are going to do here is:</p>

<ul>
<li><em>Alias</em> the <em>original</em> method so we don't overwrite it.</li>
<li>Create <em>accessors</em> to our <em>wrapped</em> method names in the <strong>WrapperOptions</strong>
class.</li>
<li>Create a new method that will eventually call the <em>original</em>, <em>before</em> and
<em>after</em> methods.</li>
</ul>


<div class="highlight"><pre><code class="ruby">    <span class="k">module</span> <span class="nn">Wrappable</span>
      <span class="k">class</span> <span class="nc">WrapperOptions</span>
        <span class="kp">attr_reader</span> <span class="ss">:before</span><span class="p">,</span> <span class="ss">:after</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
          <span class="nb">instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="kp">private</span>
        <span class="k">def</span> <span class="nf">before_run</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
          <span class="vi">@before</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">after_run</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
          <span class="vi">@after</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">original_method</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="n">wrapper_options</span> <span class="o">=</span> <span class="no">WrapperOptions</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="n">alias_method</span> <span class="ss">:old_method</span><span class="p">,</span> <span class="n">original_method</span>
        <span class="n">define_method</span> <span class="n">original_method</span> <span class="k">do</span>
          <span class="nb">send</span><span class="p">(</span><span class="n">wrapper_options</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
          <span class="nb">send</span><span class="p">(</span><span class="ss">:old_method</span><span class="p">)</span>
          <span class="nb">send</span><span class="p">(</span><span class="n">wrapper_options</span><span class="o">.</span><span class="n">after</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre>
</div>


<p>And finally test that the whole this script works:</p>

<div class="highlight"><pre><code class="bash">    ...<span class="nv">$ </span>ruby my_test.rb
    Before method
    Original method     
    After method
</code></pre>
</div>


<p>That's it.</p>

<h2>Conclusion</h2>

<p>This was a simple way to build a custom DSL, there are many DSL examples all
around the web for example:</p>

<ul>
<li>At <a href="http://deadprogrammersociety.blogspot.com/2006/11/ruby-domain-specific-languages-basics.html">Ron Evan's blog</a></li>
<li>At <a href="http://rubylearning.com/blog/2010/11/30/how-do-i-build-dsls-with-yield-and-instance_eval/">rubylearning.org's blog</a></li>
<li>At <a href="http://obiefernandez.com/presentations/obie_fernandez-agile_dsl_development_in_ruby.pdf">Obie Fernandez's blog</a></li>
</ul>


<p>Note that this implementation only supports method names as parameters, if
you want to view an example of transparently supporting <em>blocks</em> as wrappers
then look at the <a href="https://gist.github.com/762214">complete exercise gist</a>.</p>

<p>Finally, if you really need to implement callbacks then I recommend you to look at the
<a href="http://api.rubyonrails.org/classes/ActiveSupport/Callbacks.html"><strong>ActiveSupport::Callbacks</strong> package</a>.</p>

<p>Thank you for reading.</p>

<p>Regards</p>

    <div class="author_box">
      <p><b>Author:</b> Emmanuel Delgado | emmanuel.delgado@crowdint.com</p>
    </div>
    <div class="tweet">
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a>
      <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </div>
    <div class="comments">
      <h2><a href="/2011/01/10/building-a-basic-dsl-to-create-callbacks-in-ruby.html#disqus_thread">Click here for Comments</a></h2>
    </div>
  </div>
</div>

<div class="post prepend-1">
  <h1><a href="/2010/12/07/improving-your-dev-life-with-ree.html">Improving your development life with Ruby Enterprise Edition</a></h1>
  <p class="author">
    <span class="date"><b>Dec 07</b><br />2010</span>
  </p>
  <div class="body prepend-1 append-1">
    <div class="gravatar span-3"><img src="http://www.gravatar.com/avatar/f7412b373affd1d6db10752cf5d69315" class="avatar" alt="Avatar" /></div>
    <p>Have you ever wondered if you can do something to make your ruby development even faster?
Are you tired of waiting for rspec to finish?
Is your rails application eating more and more memory and you have to restart your app once in a while?</p>

<p>Ok, This is one of those paths to improve your ruby dev life, nothing new, but it's very effective.</p>

<h2>What is REE?</h2>

<p>As you can read on the ruby site: "Ruby is a dynamic, open source programming language with a focus on simplicity and productivity. It has an elegant syntax that is natural to read and easy to write.... and it continues". But the most important part, as of this post, is its garbage collection technique: "<a href="http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29#Na.C3.AFve_mark-and-sweep">mark-and-sweep</a>".</p>

<p>Modern requirements has pushed developers to implement and improve current techniques to recycle memory and maximize resources.</p>

<p>Ruby Enterprise Edition has come to attack this matter, replacing the garbage collector algorithm with "<a href="http://en.wikipedia.org/wiki/Copy-on-write">copy-on-write</a>", implementing a forking model(reducing application's memory usage by 33% on average) and the most important part (again, as of this post): the ability to <a href="http://www.rubyenterpriseedition.com/documentation.html#_garbage_collector_performance_tuning">tweak the garbage collector</a> via environment variables.</p>

<p>Based on the documentation and some research made by well known companies (twitter, 37signals), you can gain a lot of performance if you tweak the garbage collector settings used by ruby enterprise edition, I'll show you my own benchmark tests. Being part of a release engineering team, I need to run all tests as fast as possible, finding this technique highly effective.</p>

<h2>Installing REE</h2>

<p>I'll guide you through this post assuming that you already have <a href="http://rvm.beginrescueend.com/rvm/install/">rvm</a> installed on your computer.</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>rvm install ree
<span class="c">#go and grab a drink, preferably coffee or beer</span>
<span class="c">#some output</span>
<span class="c">#done.</span>
ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>rvm use ree
ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>rvm list

rvm <span class="nv">rubies</span>

<span class="o">=</span>&gt; ree-1.8.7-2010.02 <span class="o">[</span> x86_64 <span class="o">]</span>
   ruby-1.8.7-p302 <span class="o">[</span> x86_64 <span class="o">]</span>
   ruby-1.9.1-p378 <span class="o">[</span> x86_64 <span class="o">]</span>
ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>ruby -v
ruby 1.8.7 <span class="o">(</span>2010-04-19 patchlevel 253<span class="o">)</span> <span class="o">[</span>i686-darwin10.4.0<span class="o">]</span>, MBARI 0x6770, Ruby Enterprise Edition 2010.02

ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="err">$</span>
</code></pre>
</div>


<p>Done, you are ready to rock using ruby enterprise edition, next step, install gems under ree</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>rvm gemset create my_new_gems
ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>bundle install
Installing ...
Installing ....
Using bundler <span class="o">(</span>1.0.3<span class="o">)</span> 
Your bundle is <span class="nb">complete</span>! It was installed into /Users/ecruz/.rvm/gems/ree-1.8.7-2010.02@my_new_gems

ecruz@ecruz-mbp:project <span class="o">(</span>master<span class="o">)</span><span class="err">$</span>
</code></pre>
</div>


<p>Hint: go to this <a href="http://blog.crowdint.com/2010/08/17/use-a-project-specific-ruby-version-rvm.html">post</a> and make rvm always use your desired gemset@ruby</p>

<p>Ok, perfect... let's play with our new toy, I'll run our rspec suite to demonstrate the ree power</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">time </span>rake <span class="nv">spec</span>
<span class="o">=</span>&gt; Building fixtures
..
... in 62.33s

SLOW SPEC: 5.9991  Test A
SLOW SPEC: 5.3510  Test B
SLOW SPEC: 7.8485  Test C
SLOW SPEC: 7.6710  Test D
SLOW SPEC: 5.8465  Test E
SLOW SPEC: 5.9972  Test F
SLOW SPEC: 5.9707  Test G
SLOW SPEC: 5.4557  Test H
SLOW SPEC: 6.0631  Test I
SLOW SPEC: 5.4861  Test J
1763/1763:     100% |##########################################| Time: 00:10:43

Finished in 643.211296 seconds

1763 examples, 0 failure, 1 pending

real  13m45.186s
user  11m0.745s
sys   0m20.082s
</code></pre>
</div>


<p>Mmhm, that was... 'fast', I wonder how previous numbers performed.</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>rvm use 1.8.7
Using /Users/ecruz/.rvm/gems/ruby-1.8.7-p302
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>rvm gemset create my_new_gems
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>rvm gemset use my_new_gems
Now using gemset <span class="s1">&#39;my_new_gems&#39;</span>
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>bundle install
Installing ...
Installing ....
Using bundler <span class="o">(</span>1.0.3<span class="o">)</span> 
Your bundle is <span class="nb">complete</span>! It was installed into /Users/ecruz/.rvm/gems/ruby-1.8.7-p302@my_new_gems

ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">time </span>rake <span class="nv">spec</span>
<span class="o">=</span>&gt; Building fixtures
...
in 84.92s

SLOW SPEC: 8.6082  Test A
SLOW SPEC: 10.3736 Test B
SLOW SPEC: 11.3856 Test C
SLOW SPEC: 7.4864  Test D
SLOW SPEC: 6.5998  Test E
SLOW SPEC: 8.8307  Test F
SLOW SPEC: 8.8013  Test G
SLOW SPEC: 8.8126  Test H
SLOW SPEC: 8.9622  Test I
SLOW SPEC: 8.9033  Test J
1763/1763:     100% |##########################################| Time: 00:15:30

Finished in 930.143889 seconds

1763 examples, 0 failure, 1 pending

real  19m40.629s
user  16m13.691s
sys   0m21.632s
</code></pre>
</div>


<p>Wow! I hadn't noticed the huge difference between ruby 1.8.7 and ruby enterprise edition, that was ~1.4x faster!</p>

<p>Ok, I got huge difference between two versions, the question is, can it be improved? The answer is found in REE documentation, section <a href="http://www.rubyenterpriseedition.com/documentation.html#_garbage_collector_performance_tuning">Garbage Collector Performance Tunning</a>. Twitter has published their production settings, let's see what we can get.</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>rvm use ree
Using /Users/ecruz/.rvm/gems/ree-1.8.7-2010.02
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>rvm gemset use my_new_gems
Now using gemset <span class="s1">&#39;my_new_gems&#39;</span>
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">time </span><span class="nv">RUBY_HEAP_MIN_SLOTS</span><span class="o">=</span>500000 <span class="nv">RUBY_HEAP_SLOTS_INCREMENT</span><span class="o">=</span>250000 <span class="nv">RUBY_HEAP_SLOTS_GROWTH_FACTOR</span><span class="o">=</span>1 <span class="nv">RUBY_GC_MALLOC_LIMIT</span><span class="o">=</span>50000000 rake <span class="nv">spec</span>
<span class="o">=</span>&gt; Building fixtures
..
...in 44.06s
SLOW SPEC: 6.2397  Test C
SLOW SPEC: 8.4131  Test D
SLOW SPEC: 5.6498  Test E
1763/1763:     100% |##########################################| Time: 00:06:53

Finished in 413.352603 seconds

1763 examples, 0 failure, 1 pending

real  9m26.457s
user  6m46.696s
sys   0m20.475s
</code></pre>
</div>


<p>You should've seen my face when I came back and saw the results, that meant 2.2x faster!</p>

<p>My next thought was: I have to make this a permanent change in my system, so it was easy:</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;RUBY_HEAP_MIN_SLOTS=500000&quot;</span> &gt;&gt; ~/.bash_profile
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;RUBY_HEAP_SLOTS_INCREMENT=250000&quot;</span> &gt;&gt; ~/.bash_profile
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;RUBY_HEAP_SLOTS_GROWTH_FACTOR=1&quot;</span> &gt;&gt; ~/.bash_profile
ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;RUBY_GC_MALLOC_LIMIT=50000000&quot;</span> &gt;&gt; ~/.bash_profile
</code></pre>
</div>


<p>After I put new configs to always apply, I decided to benchmark the app, via web, and I found this:</p>

<h3>Using Standard Ruby 1.8.7</h3>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>ab -n 1000 -c 100 http://127.0.0.1:8080/store/Category/1/1/100/new
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 655654 <span class="nv">$&gt;</span>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 <span class="o">(</span>be patient<span class="o">)</span>

Server Software:        
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /store/Category/1/1/100/new
Document Length:        97015 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   56.476 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      97360264 bytes
HTML transferred:       97015000 bytes
Requests per second:    17.71 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       5647.631 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       56.476 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          1683.51 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:        0    0   0.8      0       6
Processing:    89 5378 899.5   5653    6163
Waiting:       88 5377 899.5   5652    6162
Total:         92 5378 898.9   5653    6165
</code></pre>
</div>


<h3>Ruby Enterprise Edition</h3>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>ab -n 1000 -c 100 http://127.0.0.1:8080/store/Category/1/1/100/new
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 655654 <span class="nv">$&gt;</span>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 <span class="o">(</span>be patient<span class="o">)</span>


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /store/Category/1/1/100/new
Document Length:        97015 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   45.212 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      97360134 bytes
HTML transferred:       97015000 bytes
Requests per second:    22.12 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       4521.241 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       45.212 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          2102.92 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:        0    1   1.0      0       5
Processing:    83 4285 706.4   4456    5027
Waiting:       82 4284 706.4   4455    5026
Total:         88 4286 705.5   4456    5028
</code></pre>
</div>


<h3>Ruby Enterprise Edition with twitter settings</h3>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>ab -n 1000 -c 100 http://127.0.0.1:8080/store/Category/1/1/100/new
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 655654 <span class="nv">$&gt;</span>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 <span class="o">(</span>be patient<span class="o">)</span>


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /store/Category/1/1/100/new
Document Length:        97015 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   31.348 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      97360048 bytes
HTML transferred:       97015000 bytes
Requests per second:    31.90 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       3134.784 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       31.348 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          3033.01 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:        0    0   0.9      0       5
Processing:   210 2962 562.4   3074    3873
Waiting:      210 2961 562.4   3073    3872
Total:        215 2963 561.6   3074    3873
</code></pre>
</div>


<h3>Ruby Enterprise Edition with 37signals settings</h3>

<p>37signals has published their production settings too, and I tried to apply them in my project and I got:</p>

<div class="highlight"><pre><code class="bash">ecruz@ecruz-mbp:project <span class="o">(</span>develop<span class="o">)</span><span class="nv">$ </span>ab -n 1000 -c 100 http://127.0.0.1:8080/store/Category/1/1/100/new
This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 655654 <span class="nv">$&gt;</span>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking 127.0.0.1 <span class="o">(</span>be patient<span class="o">)</span>


Server Software:        
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /store/Category/1/1/100/new
Document Length:        97015 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   46.230 seconds
Complete requests:      1000
Failed requests:        0
Write errors:           0
Total transferred:      97360135 bytes
HTML transferred:       97015000 bytes
Requests per second:    21.63 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       4622.981 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       46.230 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          2056.64 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:        0    0   0.9      0       5
Processing:    79 4390 760.8   4473    5830
Waiting:       78 4390 760.8   4472    5829
Total:         84 4391 760.0   4473    5830
</code></pre>
</div>


<p>For all my tests, I used unicorn with 3 workers running in production mode and memcached enabled. Another huge difference is memory usage, I've seen flat, much less memory utilization and response time has been responding ~1.8x faster. You should definitively consider using this approach in your production environments.</p>

<p>*Disclaimer, this is not an extensive research about REE and it's features, it's just intended to show small tweaks that can make a huge difference in your daily development work.</p>

    <div class="author_box">
      <p><b>Author:</b> Edwin Cruz | edwin.cruz@crowdint.com</p>
    </div>
    <div class="tweet">
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a>
      <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </div>
    <div class="comments">
      <h2><a href="/2010/12/07/improving-your-dev-life-with-ree.html#disqus_thread">Click here for Comments</a></h2>
    </div>
  </div>
</div>

<div class="post prepend-1">
  <h1><a href="/2010/11/30/rspec-for-really-newbies.html">RSpec for really newbies</a></h1>
  <p class="author">
    <span class="date"><b>Nov 30</b><br />2010</span>
  </p>
  <div class="body prepend-1 append-1">
    <div class="gravatar span-3"><img src="http://www.gravatar.com/avatar/2f2bc78de007915554f49c3ea0fef125" class="avatar" alt="Avatar" /></div>
    <p>First off, this post is meant to be a brief introduction for testing Rails applications with RSpec, I'll only get into model and controller testing.</p>

<h2>What is RSpec?</h2>

<p>Well, it’s easy, RSpec is a framework for Ruby that allows us make scenarios for our applications and help us test them.
The main goal about testing your objects with RSpec, is that you test what your object is going to do, <a href="http://en.wikipedia.org/wiki/Behavior_driven_development">Behaviour Driven Development</a>. The syntax is very simple, and human readable, this way you can read it as if you were having a conversation with your client to determine what exactly they want the project to do. It’s very easy to use, as long as you know exactly what you want to test, and here is where I think most of us usually get stuck...
So, after this brief introduction, let’s get to the action!</p>

<h2>How do we start an RSpec test for our rails application?</h2>

<p>Say you already have a <em>Rails3</em> project. In your Gemfile add the next lines.</p>

<div class="highlight"><pre><code class="bash">group :development, :test <span class="k">do</span>
<span class="k">  </span>gem <span class="s2">&quot;rspec-rails&quot;</span> , <span class="s2">&quot;&gt;= 2.2.0&quot;</span>
end
</code></pre>
</div>


<p>Next run the <em>bundle install</em> command in your console in order to install all your gems in the Gemfile. After the bundle is finished write in your console</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>rails generate rspec:install
</code></pre>
</div>


<p>With this generator we get the necessary files to run the specs and the directory in our app where we are going to save them.
To finish with this small setup you should run the next commands to make sure everything is running fine in your app!</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>rake db:migrate
<span class="nv">$ </span>rake db:test:prepare
<span class="nv">$ </span>rake spec
</code></pre>
</div>


<p>After this, every time you generate from the console a new model or controller, RSpec will automatically create the spec file for you... Now you are more than ready to start testing!</p>

<h2>Let’s begin with Model testing</h2>

<p> <em>RSpec is all about expectations</em>. What are you expecting an object to do? That’s what you must be thinking when you start a new test.
Normally in a Model, what do you do? You basically validate the fields on your tables, or create definitions in order to get new queries, among other things.
So that’s what you must test, for this you have the following magic words: <br /></p>

<p><em>describe, context, before, it and should</em></p>

<p><em>describe</em>, as the word says, it will help you describe what you want the method to do. <br />
<em>context</em>, will help you to describe the environment or the background where your tests will be running at. <br />
<em>before</em>, will help you define stuff you need to be done before you test a method, for example, if you need to simulate an account, a shipping_cart, before is your friend. <br />
<em>it</em>, is meant to be, also, a descriptor for the situation you are testing. <br />
<em>should and should</em>_<em>not</em>, with this magic word, you will be able to compare if you’ve received what you were expecting. <em>Remember it’s all about expectations</em>.<br /></p>

<p>In the following example, we are going to test the Account Model in an application, the first step is to describe the model. Next we define the context and create some accounts in the before segment.
Now, we check that the created accounts have valid attributes, for that we created an account without an e-mail address, which we test in the second example. Finally the second context is meant to search an account by its e-mail address.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">describe</span> <span class="no">Account</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s2">&quot;when an account is created it has to have an e-mail address&quot;</span> <span class="k">do</span>
      <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
        <span class="vi">@account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">create!</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;test@test.com&quot;</span>
        <span class="vi">@account2</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">create</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Test2&quot;</span>
      <span class="k">end</span> 
      
      <span class="n">it</span> <span class="s2">&quot;validates the account attributes&quot;</span> <span class="k">do</span>
        <span class="vi">@account</span><span class="o">.</span><span class="n">should</span> <span class="n">be_valid</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">&quot;doesn&#39;t validates the account attributes&quot;</span> <span class="k">do</span>
        <span class="vi">@account2</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_valid</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s2">&quot;when an account is searched by its e-mail address&quot;</span> <span class="k">do</span> 
      <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
        <span class="vi">@account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">create!</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Test Name&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;test@test.com&quot;</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">&quot;should find the account&quot;</span> <span class="k">do</span>
        <span class="no">Account</span><span class="o">.</span><span class="n">find_by_email</span><span class="p">(</span><span class="s2">&quot;test@test.com&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<h2>...Now Controllers</h2>

<p>It’s basically the same thing as with models, the difference is that you need to simulate when you’re sending data to a method, what normally a POST, GET, PUT or DELETE request from our browser would be. This is done, for example, by typing <em>get :show, :id => @account.id</em> in our test file where we say which method we want to use (<em>:show</em>) and which parameter we want to send (<em>:id</em>).
In the next example we test the show method from our Accounts controller, let’s say we want the method to find an account by its id. We go the same way as before, we create two accounts in the before segment, then we describe the method we are testing and what it should do. In this case as our example says, it should find the account by its id. The <em>assigns[:account]</em> is what the method returns to the call. In this case the id, name and e-mail. <br />
The last example tests the <em>:new</em> method in the controller, again we <em>post</em> the name and email of the account and then we look for the registered name, if it's found then it has been successfully created.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">describe</span> <span class="no">AccountsController</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;GET show&quot;</span> <span class="k">do</span>
    <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
      <span class="vi">@account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">create!</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s1">&#39;test@test.com&#39;</span>
    <span class="k">end</span>
    
    <span class="n">it</span> <span class="s2">&quot;should find the account by its id&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="vi">@account</span><span class="o">.</span><span class="n">id</span>
      <span class="n">assigns</span><span class="o">[</span><span class="ss">:account</span><span class="o">].</span><span class="n">name</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;Name&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">describe</span> <span class="s2">&quot;POST new&quot;</span> <span class="k">do</span> 
    <span class="n">it</span> <span class="s2">&quot;should register the new account&quot;</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:account</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Name 3&quot;</span><span class="p">,</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">&quot;test4@test.com&quot;</span><span class="p">}</span>
      <span class="n">assigns</span><span class="o">[</span><span class="ss">:account</span><span class="o">].</span><span class="n">name</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;Name 3&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<p>To finish, I want to talk a little bit about the views, which are not often tested, at least with RSpec, if you want to get into view testing, I think it will be better for you to use <a href="https://github.com/brynary/webrat">Webrat</a>, <a href="http://cukes.info/">Cucumber</a> or <a href="http://seleniumhq.org/">Selenium</a>. I'll just leave this for another post.</p>

<h2>Hope this will help you start with the long road of BDD!</h2>

<h2>Resources</h2>

<p><a href="http://www.pragprog.com/titles/achbd/the-rspec-book">The RSpec Book</a><br />
<a href="http://rspec.info/">RSpec's homepage</a><br />
<a href="http://rspec.info/rails/writing/models.html">Model testing</a><br />
<a href="http://rspec.info/rails/writing/controllers.html">Controller testing</a><br /></p>

    <div class="author_box">
      <p><b>Author:</b> Ana Rosas | ana@crowdint.com</p>
    </div>
    <div class="tweet">
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a>
      <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </div>
    <div class="comments">
      <h2><a href="/2010/11/30/rspec-for-really-newbies.html#disqus_thread">Click here for Comments</a></h2>
    </div>
  </div>
</div>

<div class="post prepend-1">
  <h1>Recent Posts</h1>
  <ul class="archives">

  <li><span><b>10 Jan 2011</b></span> &raquo; <a href="/2011/01/10/building-a-basic-dsl-to-create-callbacks-in-ruby.html">Building a basic DSL to create callbacks in Ruby</a></li>

  <li><span><b>07 Dec 2010</b></span> &raquo; <a href="/2010/12/07/improving-your-dev-life-with-ree.html">Improving your development life with Ruby Enterprise Edition</a></li>

  <li><span><b>30 Nov 2010</b></span> &raquo; <a href="/2010/11/30/rspec-for-really-newbies.html">RSpec for really newbies</a></li>

  <li><span><b>24 Nov 2010</b></span> &raquo; <a href="/2010/11/24/watermarking-images.html">Watermarking images minimizing the overhead</a></li>

  <li><span><b>17 Nov 2010</b></span> &raquo; <a href="/2010/11/17/rack-basics-a-rack-introduction.html">Rack Basics - A Rack Introduction</a></li>

  <li><span><b>11 Nov 2010</b></span> &raquo; <a href="/2010/11/11/subdomains-in-rails-2-and-3.html">Subdomains in Rails (2.3.x & 3)</a></li>

  <li><span><b>05 Nov 2010</b></span> &raquo; <a href="/2010/11/05/controller-responders-in-rails-3.html">Controller responders in Rails 3</a></li>

  <li><span><b>01 Nov 2010</b></span> &raquo; <a href="/2010/11/01/ignoring-files-with-git.html">Ignoring files with Git</a></li>

  <li><span><b>27 Oct 2010</b></span> &raquo; <a href="/2010/10/27/working-with-postgresql-and-rails3.html">Working with PostgreSQL and Rails3</a></li>

  <li><span><b>22 Oct 2010</b></span> &raquo; <a href="/2010/10/22/improve-your-seo-with-a-sitemap.html">Improve your SEO with a sitemap</a></li>

  <li><span><b>18 Oct 2010</b></span> &raquo; <a href="/2010/10/18/magmarails-2010-was-a-success.html">Magma Rails 2010, a success!</a></li>

  <li><span><b>07 Oct 2010</b></span> &raquo; <a href="/2010/10/07/magma-rails.html">Magma Rails is just around the corner!</a></li>

  <li><span><b>28 Sep 2010</b></span> &raquo; <a href="/2010/09/28/negative-code.html">Negative Code</a></li>

  <li><span><b>22 Sep 2010</b></span> &raquo; <a href="/2010/09/22/first-contact-with-regular-expressions.html">First contact with regular expressions</a></li>

  <li><span><b>17 Sep 2010</b></span> &raquo; <a href="/2010/09/17/installing-gems-skipping-rdoc-and-ri.html">Installing gems skipping RDoc and RI</a></li>

  <li><span><b>10 Sep 2010</b></span> &raquo; <a href="/2010/09/10/customize-your-generators-workflow.html">Customize your Generators Workflow in Rails 3.0.0</a></li>

  <li><span><b>06 Sep 2010</b></span> &raquo; <a href="/2010/09/06/a-simple-way-to-setup-a-class-for-global-values.html">A simple way to setup a class for global values</a></li>

  <li><span><b>31 Aug 2010</b></span> &raquo; <a href="/2010/08/31/open-and-watch-specific-git-branches-using-gitx.html">Open and watch specific git branches using gitx</a></li>

  <li><span><b>26 Aug 2010</b></span> &raquo; <a href="/2010/08/26/thin-vs-unicorn.html">Benchmarking thin vs unicorn</a></li>

  <li><span><b>20 Aug 2010</b></span> &raquo; <a href="/2010/08/20/what-i-would-ve-loved-to-know-when-i-first-met-ruby.html">What I would've loved I had known when I first met Ruby</a></li>

  </ul>
</div>

        </div>
        <div class="right-side span-5 last prepend-1">
          <h1><a href="/">Blog Home</a></h1>
<h1>About Crowd Interactive</h1>
<p class="append-1 about">Crowd Interactive is an American web design and development company that happens to work in Colima, Mexico... <a href="/about.html">Read More...</a></p>
<div id="writeSkribitHere"></div><script src="http://assets.skribit.com/javascripts/SkribitWidget.js?renderTo=writeSkribitHere&amp;blog=ef56d1750b6040b271e0080ef2886f3b&amp;cnt=5&noCSS=1"></script><noscript>Sorry, but the <a href="http://skribit.com" title="Skribit - Cure Writer's Block">Skribit</a> widget only works on browsers with JavaScript support.  <a href="http://skribit.com/blogs/crowdint-tech" title="Skribit Suggestions for Crowdint Tech">View suggestions for this blog here.</a></noscript>
<h1>Our Favorite Sites</h1>
<ul>
  <li><a href="http://www.crowdint.com">Crowd Interactive</a></li>
  <li><a href="http://www.magmarails.com">MagmaRails</a></li>
  <li><a href="http://rubyonrails.org">Ruby on Rails</a></li>
  <li><a href="http://ruby-lang.org">Ruby-Lang</a></li>
  <li><a href="http://github.com/crowdint">Github</a></li>
</ul>
<h1>Stuff we've built</h1>
<ul>
  <li><a href="http://www.modcloth.com">ModCloth</a></li>
  <li><a href="http://www.creativeallies.com">Creative Allies</a></li>
  <li><a href="http://www.nameframe.com">Nameframe</a></li>
  <li><a href="http://github.com/crowdint/rails3-jquery-autocomplete">Rails3-jQuery-Autocomplete</a></li>
  <li><a href="http://github.com/crowdint/rankstar">rankstar</a></li>
  <li><a href="http://github.com/crowdint/blog.crowdint.com">This site's source code</a></li>
</ul>
<h1>Older Posts</h1>
<ul>
  <li><a href="/archive.html">Archive</a></li>
</ul>

Site Powered by <a href="http://github.com/mojombo/jekyll">Jekyll</a>

        </div>
      </div>
      <div class="round-bottom span-24">
        &nbsp;
      </div>
    </div>

  </div>
  <div id="footer">
    <div class="copyContent" >
      <p class="copy">Copyright &copy; 2010, Crowd Interactive. All rights reserved.</p>
    </div>
  </div>
  <script type="text/javascript">
  var disqus_shortname = 'crowdinttech';
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.src = 'http://disqus.com/forums/crowdinttech/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
  </script>
</body>
</html>
